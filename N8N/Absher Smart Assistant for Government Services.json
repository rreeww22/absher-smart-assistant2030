{
  "name": "Absher Smart Assistant for Government Services",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "absher-request-processor",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "d2a8f035-9eb1-4340-9349-ec21995bd200",
      "name": "Request Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        0,
        0
      ],
      "webhookId": "c7239252-3808-4ca1-ba0f-d04fea80a5f2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "statusOptions",
              "value": "[\"processing\", \"completed\", \"received\"]",
              "type": "array"
            },
            {
              "id": "id-2",
              "name": "ticketPrefix",
              "value": "REQ-",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "0f68c1bb-3a31-4508-ad39-797e1d101a17",
      "name": "Workflow Configuration",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        224,
        0
      ]
    },
    {
      "parameters": {
        "jsCode": "// Validate incoming JSON has required fields\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const data = item.json;\n  \n  // Check if required fields exist\n  if (!data.intent || !data.details) {\n    results.push({\n      json: {\n        success: false,\n        error: \"Missing required fields: 'intent' and 'details' are required\",\n        received: data,\n        timestamp: new Date().toISOString()\n      }\n    });\n  } else {\n    // Pass through the data if validation succeeds\n    results.push({\n      json: {\n        ...data,\n        validated: true\n      }\n    });\n  }\n}\n\nreturn results;"
      },
      "id": "a964ac6e-71c1-4bc9-aea1-556014a8b3cb",
      "name": "Validate Input",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        448,
        0
      ]
    },
    {
      "parameters": {
        "jsCode": "// ------------------------------\n// Generate ticket ID\n// ------------------------------\nconst currentYear = new Date().getFullYear();\nconst randomNum = Math.floor(10000 + Math.random() * 90000);\nconst ticketId = `TCK-${currentYear}-${randomNum}`;\n\n// ------------------------------\n// Get Data From Previous Node\n// ------------------------------\nconst intent = $input.item.json.intent || 'unknown';\nconst details = $input.item.json.details || {};\nconst detailsDescription = details.description || \"\";\n\n// ------------------------------\n// User Static Info\n// ------------------------------\nconst userName = 'Ø±ÙŠÙ…Ø§ Ø§Ù„Ø­Ù…Ø¯';\nconst nationalId = '1098765432';\nconst mobile = '+966500000000';\n\n// ------------------------------\n// Detect Language (Simple & Effective)\n// ------------------------------\nfunction detectLanguage(text) {\n  if (!text) return \"ar\"; // default Arabic\n\n  const arabic = /[\\u0600-\\u06FF]/;\n  const urdu = /[Ø¡-ÛŒ]/;               // Urdu Arabic script\n  const tagalogWords = [\"mahal\", \"salamat\", \"kumusta\", \"ito\", \"ako\"];\n  const english = /[a-zA-Z]/;\n\n  if (arabic.test(text)) return \"ar\";\n  if (urdu.test(text)) return \"ur\";\n  if (tagalogWords.some(w => text.toLowerCase().includes(w))) return \"tl\";\n  if (english.test(text)) return \"en\";\n\n  return \"ar\";\n}\n\nconst lang = detectLanguage(detailsDescription);\n\n// ------------------------------\n// Service Name Logic\n// ------------------------------\nlet serviceName;\nif (detailsDescription) {\n  serviceName = detailsDescription;\n} else {\n  const map = {\n    passport_renewal: \"ØªØ¬Ø¯ÙŠØ¯ Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ±\",\n    id_renewal: \"ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©\",\n    license_renewal: \"ØªØ¬Ø¯ÙŠØ¯ Ø±Ø®ØµØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©\",\n    status_inquiry: \"Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨\",\n    check_status: \"Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨\",\n    appointment_booking: \"Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯\",\n    book_appointment: \"Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯\",\n    create_request: \"Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯\",\n    update_request: \"ØªØ­Ø¯ÙŠØ« Ø·Ù„Ø¨\",\n    cancel_request: \"Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨\",\n    lost_id_request: \"Ø¨Ù„Ø§Øº ÙÙ‚Ø¯Ø§Ù† Ù‡ÙˆÙŠØ©\",\n    general_service_request: \"Ø·Ù„Ø¨ Ø®Ø¯Ù…Ø© Ø¹Ø§Ù…Ø©\",\n  };\n\n  serviceName = map[intent] || \"Ø®Ø¯Ù…Ø© Ø¹Ø§Ù…Ø©\";\n}\n\n// ------------------------------\n// Estimated Time Logic\n// ------------------------------\nlet estimatedTime = {\n  create_request: \"24 hours\",\n  update_request: \"12 hours\",\n  check_status: \"instant\",\n  status_inquiry: \"instant\",\n  cancel_request: \"10 minutes\",\n  book_appointment: \"immediately\",\n  appointment_booking: \"immediately\",\n  lost_id_request: \"24 hours\",\n  general_service_request: \"24 hours\",\n  passport_renewal: \"5-7 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„\",\n  id_renewal: \"3-5 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„\",\n  license_renewal: \"2-3 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„\",\n}[intent] || \"24 hours\";\n\n// ------------------------------\n// Multilingual Reply Generator\n// ------------------------------\nfunction generateReply(lang) {\n  switch (lang) {\n    case \"en\":\n      return `Your request has been prepared, Reema ğŸŒ¿. Your ticket number is ${ticketId}. Let me know if you'd like more details.`;\n    case \"ur\":\n      return `Ø¢Ù¾ Ú©ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªÛŒØ§Ø± Ú©Ø± Ø¯ÛŒ Ú¯Ø¦ÛŒ ÛÛ’ØŒ Ø±ÛŒÙ…Ø§ ğŸŒ¿Û” Ø¢Ù¾ Ú©Ø§ Ù¹Ú©Ù¹ Ù†Ù…Ø¨Ø± ${ticketId} ÛÛ’Û” Ø§Ú¯Ø± Ø¢Ù¾ Ù…Ø²ÛŒØ¯ ØªÙØµÛŒÙ„Ø§Øª Ú†Ø§ÛÛŒÚº ØªÙˆ Ù…Ø¬Ú¾Û’ Ø¨ØªØ§Ø¦ÛŒÚºÛ”`;\n    case \"tl\":\n      return `Handa na ang iyong request, Reema ğŸŒ¿. Ito ang iyong ticket number: ${ticketId}. Sabihin mo lang kung gusto mo pa ng detalye.`;\n    default: // Arabic\n      return `ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø·Ù„Ø¨Ùƒ ÙŠØ§ Ø±ÙŠÙ…Ø§ ğŸŒ¿ ÙˆØ±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø© Ù‡Ùˆ ${ticketId}. Ø£Ù‚Ø¯Ø± Ø£Ø´Ø±Ø­ Ù„Ùƒ ØªÙØ§ØµÙŠÙ„ Ø£ÙƒØ«Ø± Ø¥Ø°Ø§ Ø­Ø¨ÙŠØªÙŠ.`;\n  }\n}\n\nconst reply = generateReply(lang);\n\n// ------------------------------\n// Build Final Ticket Object\n// ------------------------------\nconst ticket = {\n  ticket_id: ticketId,\n  status: \"processing\",\n  service_name: serviceName,\n  estimated_time: estimatedTime,\n  user: {\n    name: userName,\n    national_id: nationalId,\n    mobile: mobile\n  },\n  intent: intent,\n  details: details,\n  submitted_at: new Date().toISOString()\n};\n\n// ------------------------------\n// Return Final JSON\n// ------------------------------\nreturn {\n  json: {\n    success: true,\n    ticket: ticket,\n    reply: reply,\n    language_detected: lang\n  }\n};\n"
      },
      "id": "5fb41adf-bc50-4ca4-a804-914bde256753",
      "name": "Generate Ticket & Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        672,
        0
      ]
    },
    {
      "parameters": {
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "id": "1786a05b-c73a-4903-8b40-6c90fb2086cd",
      "name": "Return JSON Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        896,
        0
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Request Webhook": {
      "main": [
        [
          {
            "node": "Workflow Configuration",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Workflow Configuration": {
      "main": [
        [
          {
            "node": "Validate Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Input": {
      "main": [
        [
          {
            "node": "Generate Ticket & Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Ticket & Response": {
      "main": [
        [
          {
            "node": "Return JSON Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "29ce0bbd-666b-4d08-b510-b7845a2623f8",
  "meta": {
    "instanceId": "c4641c13926b75e130bcc3939984dea6f1d2312a9d791659c371785e42c34290"
  },
  "id": "WQO3urJgqIx7WfPA",
  "tags": []
}